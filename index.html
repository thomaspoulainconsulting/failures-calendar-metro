<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calendrier des pannes</title>
    <style>
        body {
          font-family: "MS Sans Serif", Tahoma, sans-serif;
          background-color: #008080;
          color: black;
          margin: 0;
          cursor: url('https://win98icons.alexmeub.com/cursors/arrow.cur'), auto;
        }
        h1 {
          text-align: center;
          background-color: #000080;
          color: white;
          padding: 10px;
          border: 2px solid #ffffff;
          box-shadow: inset -2px -2px #000, inset 2px 2px #ccc;
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
        }
        h1::before {
          content: url('https://icons.iconarchive.com/icons/dtafalonso/winxp/16/Bug-icon.png');
          display: inline-block;
        }
        .taskbar {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          height: 32px;
          background: #c0c0c0;
          border-top: 2px solid #fff;
          box-shadow: inset 0 1px #808080;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 5px;
          font-size: 14px;
          z-index: 9999;
        }
        .start-button {
          background: #e0e0e0;
          border: 2px outset #fff;
          padding: 2px 8px;
          font-family: "MS Sans Serif", Tahoma, sans-serif;
          display: flex;
          align-items: center;
          gap: 4px;
          cursor: pointer;
        }
        .start-button.pressed {
          border: 2px inset #808080;
          background: #d0d0d0;
        }
        .start-button img {
          width: 16px;
          height: 16px;
        }
        .start-menu {
          position: fixed;
          bottom: 32px;
          left: 0;
          width: 200px;
          background: #c0c0c0;
          border: 2px outset #fff;
          box-shadow: inset -2px -2px #000, inset 2px 2px #808080;
          padding: 10px;
          font-size: 14px;
          display: none;
          z-index: 9999;
        }
        .clock {
          padding: 2px 6px;
          background: #dcdcdc;
          border: 2px inset #fff;
        }
        .calendar {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 20px;
          padding: 0px 10px;
        }
        .title {
            margin: 10px;
        }
        .month {
          background: #c0c0c0;
          padding: 10px;
          border: 2px solid #fff;
          box-shadow: inset -2px -2px #000, inset 2px 2px #808080;
        }
        .month h2 {
          text-align: center;
          background: linear-gradient(to bottom, #000080, #0000a0);
          color: white;
          padding: 4px;
          margin-bottom: 5px;
          border: 2px outset #fff;
          font-size: 1em;
        }
        .days {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          font-size: 12px;
          background: #dcdcdc;
          border: 2px inset #fff;
          padding: 2px;
        }
        .day-name {
          background: #a0a0a0;
          color: black;
          font-weight: bold;
          padding: 4px;
          border: 1px solid #808080;
        }
        .day {
          background: #ffffff;
          border: 1px solid #808080;
          margin: 1px;
          padding: 4px;
          text-align: center;
          height: 30px;
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
        }
        .breakdown {
          background-color: #ff0000;
          color: yellow;
          font-weight: bold;
          border: 2px ridge #000;
          animation: blink 1s step-start 0s infinite;
        }
        .breakdown::after {
          position: absolute;
          bottom: -10px;
          right: -10px;
          width: 16px;
          height: 16px;
        }
        .error-popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: #c0c0c0;
          border: 2px outset #fff;
          box-shadow: inset -2px -2px #000, inset 2px 2px #808080;
          width: 300px;
          z-index: 9999;
          font-family: "MS Sans Serif", Tahoma, sans-serif;
        }
        .error-header {
          background: #000080;
          color: white;
          padding: 4px;
          font-weight: bold;
          font-size: 14px;
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
        .error-body {
          display: flex;
          padding: 10px;
          gap: 10px;
        }
        .error-body img {
          width: 32px;
          height: 32px;
        }
        .error-buttons {
          display: flex;
          justify-content: center;
          padding: 10px;
        }
        .error-buttons button {
          font-family: "MS Sans Serif", Tahoma, sans-serif;
          background: #e0e0e0;
          border: 2px outset #fff;
          padding: 2px 10px;
        }
          a:hover {
            text-decoration: underline;
            cursor: pointer;
          }

        .retro-subtitle {
          margin: -5px auto 10px;
          width: fit-content;
          background: #c0c0c0;
          color: black;
          padding: 4px 8px;
          font-size: 12px;
          font-family: "MS Sans Serif", Tahoma, sans-serif;
          border: 2px solid #ffffff;
          box-shadow: inset -2px -2px #000, inset 2px 2px #808080;
        }

    </style>
</head>
<body>
<h1 class="title">Calendrier des pannes</h1>
<div id="subtitle" class="retro-subtitle"></div>
<div id="breakdownsTitle" class="retro-subtitle"></div>

<div class="calendar" id="calendar"></div>

<div class="start-menu" id="startMenu">Vibe coded by <a href="https://www.linkedin.com/in/thomas-poulain-freelance/" target="_blank">tpoulain (2025)</a></div>
<div class="taskbar">
    <div class="start-button" id="startButton" onclick="toggleStartMenu()">
        <img src="./start_icon.png" alt="Start">
        D√©marrer
    </div>
    <div class="clock" id="clock">
        üï∞Ô∏è <span id="clockTime"></span>
    </div>
</div>

<script>
    const startButton = document.getElementById("startButton");
    const startMenu = document.getElementById("startMenu");

    function toggleStartMenu() {
      const isOpen = startMenu.style.display === "block";
      startMenu.style.display = isOpen ? "none" : "block";
      startButton.classList.toggle("pressed", !isOpen);
    }

    function updateClock() {
      const now = new Date();
      const clockTime = document.getElementById("clockTime");
      clockTime.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    const monthNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
    const dayNames = ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"];

    const breakdowns = [
      "2025-06-27",
      "2025-06-25",
      "2025-06-24",
      "2025-06-21",
      "2025-06-20",
      "2025-06-19",
      "2025-06-17",
      "2025-06-16",
      "2025-06-13",
      "2025-06-09",
      "2025-06-08",
      "2025-06-07",
      "2025-06-06",
      "2025-06-05",
      "2025-06-03",
      "2025-06-02",
      "2025-06-01",
      "2025-05-26",
      "2025-05-24",
      "2025-05-22",
      "2025-05-20",
      "2025-05-19",
      "2025-05-17",
      "2025-05-16",
      "2025-05-15",
      "2025-05-13",
      "2025-05-12",
      "2025-05-11",
      "2025-05-11",
      "2025-05-05",
      "2025-05-01",
      "2025-04-30",
      "2025-04-29",
      "2025-04-26",
      "2025-04-22",
      "2025-04-16",
      "2025-04-19",
      "2025-04-12",
      "2025-04-11",
      "2025-04-05",
      "2025-04-04",
      "2025-04-03",
      "2025-04-02",
      "2025-03-28",
      "2025-03-25",
      "2025-03-19",
      "2025-03-17",
      "2025-03-13",
      "2025-03-12",
      "2025-03-10",
      "2025-03-09",
      "2025-03-08",
      "2025-03-05",
      "2025-02-28",
      "2025-02-26",
      "2025-02-22",
      "2025-02-21",
      "2025-02-16",
      "2025-02-15",
      "2025-02-14",
      "2025-02-13",
      "2025-02-11",
      "2025-02-10",
      "2025-02-09",
      "2025-02-08",
      "2025-02-07",
      "2025-02-04",
      "2025-02-01",
      "2025-01-31",
      "2025-01-30",
      "2025-01-29",
      "2025-01-25",
      "2025-01-24",
      "2025-01-22",
      "2025-01-16",
      "2025-01-10",
      "2025-01-06",
      "2025-01-02",
      "2025-01-01",
    ];

    // Analyse pour d√©terminer la plus longue p√©riode sans panne
    const sorted = [...new Set(breakdowns)]
      .map(d => new Date(d))
      .sort((a, b) => a - b);

    let maxDiff = 0;
    let from = null;
    let to = null;

    for (let i = 1; i < sorted.length; i++) {
      const diff = (sorted[i] - sorted[i - 1]) / (1000 * 60 * 60 * 24);
      if (diff > maxDiff) {
        maxDiff = diff;
        from = sorted[i - 1];
        to = sorted[i];
      }
    }

const today = new Date();
const startOfYear = new Date(today.getFullYear(), 0, 1); // 1er janvier
const daysSinceStart = Math.floor((today - startOfYear) / (1000 * 60 * 60 * 24));

    const joursSansPanne = maxDiff - 2;
    const subtitle = document.getElementById("subtitle");
    subtitle.textContent = `P√©riode maximale sans panne : ${joursSansPanne} jours (du ${from.toLocaleDateString()} au ${to.toLocaleDateString()})`;
    breakdownsTitle.textContent = `Nombre de pannes: ${breakdowns.length} / ${daysSinceStart} (${Math.round(breakdowns.length/daysSinceStart*100)}% du temps en panne)`;

    const calendar = document.getElementById("calendar");

    function showErrorPopup(dateStr) {
      const popup = document.createElement("div");
      popup.className = "error-popup";
      popup.innerHTML = `
        <div class="error-header">Panne</div>
        <div class="error-body">
          ‚ö†
          <div>Une panne a √©t√© enregistr√©e le ${dateStr}.</div>
        </div>
        <div class="error-buttons">
          <button onclick="this.closest('.error-popup').remove()">OK</button>
        </div>`;
      document.body.appendChild(popup);
    }


    for (let m = 0; m < 12; m++) {
      const date = new Date(2025, m, 1);
      const monthDiv = document.createElement("div");
      monthDiv.className = "month";
      const header = document.createElement("h2");
      header.textContent = monthNames[m];
      monthDiv.appendChild(header);
      const daysDiv = document.createElement("div");
      daysDiv.className = "days";
      dayNames.forEach(name => {
        const dayName = document.createElement("div");
        dayName.className = "day-name";
        dayName.textContent = name;
        daysDiv.appendChild(dayName);
      });
      let firstDay = (date.getDay() + 6) % 7;
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement("div");
        empty.className = "day";
        daysDiv.appendChild(empty);
      }
      const daysInMonth = new Date(2025, m + 1, 0).getDate();
      for (let d = 1; d <= daysInMonth; d++) {
        const day = document.createElement("div");
        day.className = "day";
        day.textContent = d;
        const dateStr = `2025-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const breakdown = breakdowns.find(b => b.date === dateStr);
        if (breakdowns.includes(dateStr)) {
          day.classList.add("breakdown");
          day.addEventListener("click", () => showErrorPopup(dateStr));
        }

        daysDiv.appendChild(day);
      }
      monthDiv.appendChild(daysDiv);
      calendar.appendChild(monthDiv);
    }
  document.addEventListener("click", (e) => {
  const isClickInside = startButton.contains(e.target) || startMenu.contains(e.target);
  if (!isClickInside) {
    startMenu.style.display = "none";
    startButton.classList.remove("pressed");
  }
});
</script>
</body>
</html>
